---
import '../styles/tokens.css';
import '../styles/utilities.css';
import Map from '../components/Map.astro';
import Inputs from '../components/Inputs.astro';
import Breakdown from '../components/Breakdown.astro';
import Assumptions from '../components/Assumptions.astro';
import ContextCards from '../components/ContextCards.astro';
import pack from '../../data/packs/2025.1.0.json';
import Modal from '../components/Modal.astro';
import TaxDeadlinesBanner from '../components/TaxDeadlinesBanner.astro';

const packSerialized = JSON.stringify(pack).replace(/</g, '\\u003c');
const packInline = `JSON.parse(decodeURIComponent('${encodeURIComponent(packSerialized)}'))`;
const seedPackScript = `(function(){try{const pack=${packInline};if(!window.__t1_pack)window.__t1_pack=pack;if(!window.__T1_PACK__)window.__T1_PACK__=pack;}catch(err){console.warn('seedPackScript failed',err);}})();`;
const faqJson = JSON.stringify({
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: [
    {
      '@type': 'Question',
      name: 'What taxes are included?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'State income, sales, property, fuel, and optional excise. Federal income, payroll, and LTCG are optional toggles.',
      },
    },
    {
      '@type': 'Question',
      name: 'Where does the data come from?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'Official DoR/DOT/ACS/BEA/BLS/IRS sources compiled into a versioned pack with a provenance registry.',
      },
    },
  ],
}).replace(/</g, '\\u003c');
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; connect-src 'self'; font-src 'self' data:;" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>T1 - State + Federal Tax Burden Map</title>
    <meta name="description" content="Interactive state tax burden estimator with optional federal layer." />
    <meta property="og:title" content="T1 - State + Federal Tax Burden Map" />
    <meta property="og:description" content="Interactive state & local tax burden estimator with optional federal layer." />
    <script type="application/ld+json" set:html={faqJson}></script>
  </head>
  <body>
    <script type="module" set:html={seedPackScript}></script>
    <main class="container stack">
      <header class="page-header stack">
        <div class="page-header__title">
          <h1 class="heading--tight">T1 - State + Federal Tax Burden Map</h1>
          <span class="chip chip--meta" aria-label="Last updated">
            Last updated | Pack {pack.registry.pack_version} | {pack.registry.built_at}
          </span>
        </div>
        <TaxDeadlinesBanner />
      </header>

      <div class="grid grid--sidebar">
        <section class="panel stack">
          <Inputs id="inputs" />
          <Assumptions pack={pack} />
        </section>

        <section class="stack">
          <Map />
          <Breakdown initialState={null} pack={pack} />
          <ContextCards pack={pack} initialState={null} />
        </section>
      </div>
    </main>
    <script type="module">
      try {
        const t = document.querySelector('h1.heading--tight');
        if (t) t.textContent = 'T1 - State + Federal Tax Burden Map';
        const og = document.querySelector('meta[property="og:title"]');
        if (og) og.setAttribute('content','T1 - State + Federal Tax Burden Map');
        document.title = 'T1 - State + Federal Tax Burden Map';
      } catch {}
    </script>
    <!-- Inject the current data pack for all client scripts -->
<script id="t1-pack" type="application/json" set:html={packSerialized}></script>
<script type="module">
  try {
    if (!window.__T1_PACK__ && window.__t1_pack) {
      window.__T1_PACK__ = window.__t1_pack;
    }
  } catch (e) {
    console.warn('t1-pack inject failed', e);
  }
</script>
  </body>
</html>
